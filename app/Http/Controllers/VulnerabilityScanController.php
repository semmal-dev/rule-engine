<?php

namespace App\Http\Controllers;


use App\Jobs\VulnerabilityScanJob;
use Illuminate\Http\Request;


class VulnerabilityScanController extends Controller
{
    public function uploadDependencies(Request $request) 
    {
        $user = auth()->user();
        if ($request->hasFile('files')) {
            $files = $request->file('files');

            if (!is_array($files)) {
                $files = [$files]; 
            }
            foreach ($files as $file) {
                $path = $file->store('dependencies');
                $fullPath = storage_path('app/private/' . $path); 
                $fileName = $file->getClientOriginalName();
                VulnerabilityScanJob::dispatch($user, $fileName, $fullPath);
            }

            return response()->json(['message' => 'Files uploaded and vulnerability check initiated!'], 200);
        }

        return response()->json(['error' => 'No files uploaded'], 400);
    }
}
